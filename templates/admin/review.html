{% extends 'admin/base.html' %}
{% block body %}
    <div class="uk-container">
        <h1><a href="{{ request.url_for('admin:admin_index') }}" uk-icon="arrow-left"></a> Forma weryfikacyjna</h1>
        <div class="uk-child-width-1-3@m uk-grid-small uk-grid-match" uk-grid>
            <div>
                <div class="uk-card uk-card-default">
                    <div class="uk-card-header">
                        <div class="uk-grid-small uk-flex-middle" uk-grid>
                            <div class="uk-width-auto">
                                <img class="uk-border-circle" width="40" height="40" src="{{ vr.google.raw['picture'] }}">
                            </div>
                            <div class="uk-width-expand">
                                <h3 class="uk-card-title uk-margin-remove-bottom">{{ vr.google.name }}</h3>
                                <p class="uk-text-meta uk-margin-remove-top">
                                    {{ vr.no }}
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="uk-card-body">
                        <p>Email: <b>{{ vr.google.email }}</b></p>
                        <p>ZÅ‚oÅ¼enie weryfikacji: <b>{{ vr.submitted }}</b></p>
                        {% if vr.reviewer %}
                            <p>Operator: <b>{{ vr.reviewer.identity.user_name }}</b></p>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div>
                <div class="uk-card uk-card-default">
                    <div class="uk-card-header">
                        <div class="uk-grid-small uk-flex-middle" uk-grid>
                            <div class="uk-width-auto">
                                <img class="uk-border-circle" width="40" height="40" src="{{ ds.avatar_url }}">
                            </div>
                            <div class="uk-width-expand">
                                <h3 class="uk-card-title uk-margin-remove-bottom">{{ ds }}</h3>
                                <p class="uk-text-meta uk-margin-remove-top">
                                    aka {{ ds.nickname or "(bez nickname)" }}
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="uk-card-body">
                        <p>Discord ID: <code>{{ ds.id }}</code></p>
                        <p>DoÅ‚Ä…czenie do discorda: <b>{{ ds.created_at }}</b></p>
                        <p>DoÅ‚Ä…czenie do serwera: <b>{{ ds.joined_at }}</b></p>
                    </div>
                </div>
            </div>
        </div>
        <h2>Dokumenty</h2>
        {% if vr.state.value == 'id required' or (vr.photo_front and vr.photo_back) %}
            {% if vr.photo_front and vr.photo_back %}
                <div class="uk-margin-small-bottom" uk-lightbox>
                    <a class="uk-button uk-button-default"
                       href="{{ request.url_for('admin:photoproxy', side='front', rid=vr.id) }}" data-alt="PrzÃ³d">
                        Przednia strona dokumentu
                        <img style="height: 120px; margin: 20px" loading="lazy"
                             src="{{ request.url_for('admin:photoproxy', side='front', rid=vr.id) }}">
                    </a>
                    <a class="uk-button uk-button-default"
                       href="{{ request.url_for('admin:photoproxy', side='back', rid=vr.id) }}" data-alt="TyÅ‚">
                        Przednia strona dokumentu
                        <img style="height: 120px; margin: 20px" loading="lazy"
                             src="{{ request.url_for('admin:photoproxy', side='back', rid=vr.id) }}">
                    </a>
                </div>
            {% else %}
                <p>UÅ¼ytkownik jeszcze nie przesÅ‚aÅ‚ dokumentÃ³w</p>
            {% endif %}
        {% elif vr.state.value != 'rejected' %}
            <div class="uk-margin-small-bottom">
                <form method="post" action="{{ request.url_for('admin:id required', rid=vr.id) }}">
                    <button type="submit" class="uk-button uk-button-default">ðŸš¨ PoproÅ› o przesÅ‚anie legitymacji
                    </button>
                </form>
            </div>
        {% else %}
            <p>UÅ¼ytkownik nie zostaÅ‚ poproszony o dokumenty.</p>
        {% endif %}

        {% if vr.state.value in ['in review', 'id required'] %}
            <div class="uk-container-small">
            <form method="post">
                <button  type="submit" class="uk-button uk-button-primary">âœ… Zaakceptuj</button>
            </form>


            <button uk-toggle="target: #confirm-{{ vr.id }}" class="uk-button uk-button-secondary">ðŸ—‘ OdrzuÄ‡</button>
            <div id="confirm-{{ vr.id }}" uk-modal>
                <div class="uk-modal-dialog uk-modal-body">
                    <h2 class="uk-modal-title">Czy jesteÅ› pewien?</h2>
                    <form method="post" action="{{ request.url_for('admin:reject', rid=vr.id) }}"
                          enctype="multipart/form-data">
                        <label>
                            Uzasadnienie decyzji
                            <textarea required name="reason"
                                      class="uk-textarea">niezgodnoÅ›Ä‡ danych</textarea>
                        </label>
                        <button class="uk-button uk-button-danger" type="submit">WYJEB GNOJA</button>
                        <button class="uk-modal-close uk-button uk-button-default" type="button">Anuluj
                        </button>
                    </form>
                </div>
            </div>

            <form method="post">
                <button disabled type="submit" class="uk-button uk-button-danger">ðŸ”¨ Zbanuj</button>
            </form>
        </div>
        {% endif %}
    </div>
{% endblock %}
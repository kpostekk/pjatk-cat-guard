{% extends 'admin/base.html' %}
{% block body %}
    <div class="">
        <h1><a href="{{ request.url_for('admin:admin_index') }}" ></a> Forma
            weryfikacyjna</h1>
        {% if vr.state.value == 'id required' %}
            <div class="" >
                <p>Ten u≈ºytkownik oczekuje na sprawdzenie dokument√≥w!</p>
            </div>
        {% elif vr.state.value == 'accepted' %}
            <div class="" >
                <p>Ten u≈ºytkownik ju≈º zosta≈Ç zweryfikowany przez <b>{{ vr.reviewer.identity.user_name }}</b>!</p>
            </div>
        {% endif %}
        {% if warns.fresh_meat %}
            <div class="" >
                <p>Data utworzenia konta i do≈ÇƒÖczenia jest kr√≥tsza ni≈º rok ({{ (ds.joined_at - ds.created_at).days }}
                    dni)</p>
            </div>
        {% endif %}
        {% if warns.weird_num %}
            <div class="" >
                <p>Numer studenta wyglƒÖda podejrzanie ({{ vr.no }})</p>
            </div>
        {% endif %}
        {% if vr.rejection %}
            <div class="  ">
                <div class="">
                    <h4>Pow√≥d odrzucenia <small>z dnia {{ vr.rejection.when }}</small></h4>
                </div>
                <div class="">
                    <p>{{ vr.rejection.reason }}</p>
                </div>
            </div>
        {% endif %}
        <div class="@m  " >
            <div>
                <div class=" ">
                    <div class="">
                        <div class=" " >
                            <div class="">
                                <img class="" width="40" height="40"
                                     src="{{ vr.google.raw['picture'] }}">
                            </div>
                            <div class="">
                                <h3 class=" ">{{ vr.google.name }}</h3>
                                <p class=" ">
                                    {{ vr.no }}
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="">
                        <p>Email: <b>{{ vr.google.email }}</b></p>
                        <p>Z≈Ço≈ºenie weryfikacji: <b>{{ vr.submitted }}</b></p>
                        {% if vr.reviewer %}
                            <p>Operator: <b>{{ vr.reviewer.identity.user_name }}</b></p>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div>
                <div class=" ">
                    <div class="">
                        <div class=" " >
                            <div class="">
                                {% if ds.avatar_url %}
                                    <img class="" width="40" height="40" src="{{ ds.avatar_url }}">
                                {% endif %}
                            </div>
                            <div class="">
                                <h3 class=" ">{{ ds }}</h3>
                                {% if ds.nickname %}
                                    <p class=" ">
                                        aka {{ ds.nickname }}
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="">
                        <p>Discord ID: <code>{{ ds.id }}</code></p>
                        <p>Do≈ÇƒÖczenie do discorda: <b>{{ ds.created_at }}</b></p>
                        <p>Do≈ÇƒÖczenie do serwera: <b>{{ ds.joined_at }}</b></p>
                    </div>
                </div>
            </div>
            <div>
                <div class=" ">
                    <div class="">
                        <h3>Zmiany statusu</h3>
                    </div>
                    <div class="">
                        <ol>
                            {% for change in vr.changes %}
                                <li>{{ change.reviewer }} zmieni≈Ç stan <b>{{ change.state_before.value }}</b> na
                                    <b>{{ change.state_after.value }}</b> <small>{{ change.when }}</small></li>
                            {% endfor %}
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        <h2>Dokumenty</h2>
        {% if vr.state.value == 'id required' or (vr.photos.ready) %}
            {% if vr.photos.ready %}
                <div class="" >
                    <a class=" "
                       href="{{ request.url_for('admin:photoproxy', side='front', rid=vr.id) }}" data-alt="Prz√≥d">
                        Przednia strona dokumentu
                        <img style="height: 120px; margin: 20px" loading="lazy"
                             src="{{ request.url_for('admin:photoproxy', side='front', rid=vr.id) }}">
                    </a>
                    <a class=" "
                       href="{{ request.url_for('admin:photoproxy', side='back', rid=vr.id) }}" data-alt="Ty≈Ç">
                        Tylna strona dokumentu
                        <img style="height: 120px; margin: 20px" loading="lazy"
                             src="{{ request.url_for('admin:photoproxy', side='back', rid=vr.id) }}">
                    </a>
                </div>
            {% else %}
                <p>U≈ºytkownik jeszcze nie przes≈Ça≈Ç dokument√≥w</p>
            {% endif %}
        {% elif vr.state.value != 'rejected' %}
            <div class="">
                <form method="post" action="{{ request.url_for('admin:id required', rid=vr.id) }}">
                    <button type="submit" class=" ">üö® Popro≈õ o przes≈Çanie legitymacji
                    </button>
                </form>
            </div>
        {% else %}
            <p>U≈ºytkownik nie zosta≈Ç poproszony o dokumenty.</p>
        {% endif %}

        <div class="">
            {% if vr.state.value in ['in review', 'id required'] %}
                <div>
                    <form method="post">
                        <button type="submit" class=" ">‚úÖ Zaakceptuj</button>
                    </form>
                </div>

            {% endif %}

            {% if vr.state.value != 'rejected' %}
                <div>
                    <button  class=" ">üóë Odrzuƒá
                    </button>
                    <div id="confirm-{{ vr.id }}" >
                        <div class=" ">
                            <h2 class="">Czy jeste≈õ pewien?</h2>
                            <form method="post" action="{{ request.url_for('admin:reject', rid=vr.id) }}"
                                  enctype="multipart/form-data">
                                <label>
                                    Uzasadnienie decyzji
                                    <textarea required name="reason"
                                              class=" ">niezgodno≈õƒá danych</textarea>
                                </label>
                                <button class=" " type="submit">WYJEB GNOJA</button>
                                <button class="  " type="button">Anuluj
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            {% endif %}

            <!-- <form method="post">
                <button disabled type="submit" class=" ">üî® Zbanuj</button>
            </form> -->
        </div>
    </div>
{% endblock %}